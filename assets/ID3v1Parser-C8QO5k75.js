import{mt as e}from"./index-BkDQ6WsT.js";import{E as t,_ as n,k as r,s as i,t as a}from"./BasicParser-BKjC58_L.js";import{u as o}from"./Util-T1uhRk1Z.js";import{t as s}from"./APEv2Parser-DZxW0bwq.js";var c=(0,e(i(),1).default)(`music-metadata:parser:ID3v1`);const l=`Blues,Classic Rock,Country,Dance,Disco,Funk,Grunge,Hip-Hop,Jazz,Metal,New Age,Oldies,Other,Pop,R&B,Rap,Reggae,Rock,Techno,Industrial,Alternative,Ska,Death Metal,Pranks,Soundtrack,Euro-Techno,Ambient,Trip-Hop,Vocal,Jazz+Funk,Fusion,Trance,Classical,Instrumental,Acid,House,Game,Sound Clip,Gospel,Noise,Alt. Rock,Bass,Soul,Punk,Space,Meditative,Instrumental Pop,Instrumental Rock,Ethnic,Gothic,Darkwave,Techno-Industrial,Electronic,Pop-Folk,Eurodance,Dream,Southern Rock,Comedy,Cult,Gangsta Rap,Top 40,Christian Rap,Pop/Funk,Jungle,Native American,Cabaret,New Wave,Psychedelic,Rave,Showtunes,Trailer,Lo-Fi,Tribal,Acid Punk,Acid Jazz,Polka,Retro,Musical,Rock & Roll,Hard Rock,Folk,Folk/Rock,National Folk,Swing,Fast-Fusion,Bebob,Latin,Revival,Celtic,Bluegrass,Avantgarde,Gothic Rock,Progressive Rock,Psychedelic Rock,Symphonic Rock,Slow Rock,Big Band,Chorus,Easy Listening,Acoustic,Humour,Speech,Chanson,Opera,Chamber Music,Sonata,Symphony,Booty Bass,Primus,Porn Groove,Satire,Slow Jam,Club,Tango,Samba,Folklore,Ballad,Power Ballad,Rhythmic Soul,Freestyle,Duet,Punk Rock,Drum Solo,A Cappella,Euro-House,Dance Hall,Goa,Drum & Bass,Club-House,Hardcore,Terror,Indie,BritPop,Negerpunk,Polsk Punk,Beat,Christian Gangsta Rap,Heavy Metal,Black Metal,Crossover,Contemporary Christian,Christian Rock,Merengue,Salsa,Thrash Metal,Anime,JPop,Synthpop,Abstract,Art Rock,Baroque,Bhangra,Big Beat,Breakbeat,Chillout,Downtempo,Dub,EBM,Eclectic,Electro,Electroclash,Emo,Experimental,Garage,Global,IDM,Illbient,Industro-Goth,Jam Band,Krautrock,Leftfield,Lounge,Math Rock,New Romantic,Nu-Breakz,Post-Punk,Post-Rock,Psytrance,Shoegaze,Space Rock,Trop Rock,World Music,Neoclassical,Audiobook,Audio Theatre,Neue Deutsche Welle,Podcast,Indie Rock,G-Funk,Dubstep,Garage Rock,Psybient`.split(`,`);var u={len:128,get:(e,n)=>{let r=new d(3).get(e,n);return r===`TAG`?{header:r,title:new d(30).get(e,n+3),artist:new d(30).get(e,n+33),album:new d(30).get(e,n+63),year:new d(4).get(e,n+93),comment:new d(28).get(e,n+97),zeroByte:t.get(e,n+127),track:t.get(e,n+126),genre:t.get(e,n+127)}:null}},d=class{constructor(e){this.len=e,this.stringType=new n(e,`latin1`)}get(e,t){let n=this.stringType.get(e,t);return n=o(n),n=n.trim(),n.length>0?n:void 0}},f=class e extends a{constructor(e,t,n){super(e,t,n),this.apeHeader=n.apeHeader}static getGenre(e){if(e<l.length)return l[e]}async parse(){if(!this.tokenizer.fileInfo.size){c(`Skip checking for ID3v1 because the file-size is unknown`);return}this.apeHeader&&(this.tokenizer.ignore(this.apeHeader.offset-this.tokenizer.position),await new s(this.metadata,this.tokenizer,this.options).parseTags(this.apeHeader.footer));let t=this.tokenizer.fileInfo.size-u.len;if(this.tokenizer.position>t){c(`Already consumed the last 128 bytes`);return}let n=await this.tokenizer.readToken(u,t);if(n){c(`ID3v1 header found at: pos=%s`,this.tokenizer.fileInfo.size-u.len);for(let e of[`title`,`artist`,`album`,`comment`,`track`,`year`])n[e]&&n[e]!==``&&await this.addTag(e,n[e]);let t=e.getGenre(n.genre);t&&await this.addTag(`genre`,t)}else c(`ID3v1 header not found at: pos=%s`,this.tokenizer.fileInfo.size-u.len)}async addTag(e,t){await this.metadata.addTag(`ID3v1`,e,t)}};async function p(e){if(e.fileInfo.size>=128){let t=new Uint8Array(3),n=e.position;return await e.readBuffer(t,{position:e.fileInfo.size-128}),e.setPosition(n),r(t,`latin1`)===`TAG`}return!1}export{f as n,p as r,l as t};